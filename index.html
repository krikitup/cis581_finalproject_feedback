<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CIS581 Final Project Feedback</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px auto; max-width: 700px; }
    h2 { text-align: center; }
    label { font-weight: bold; display: block; margin-top: 15px; }
    textarea, select { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 20px; padding: 10px 20px; cursor: pointer; }
    #status { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>CIS581 Final Project Feedback</h2>

  <!-- GROUP SELECTION -->
  <label for="group">Select Group:</label>
  <select id="group">
    <option value="">-- Select Group --</option>
  </select>

  <!-- TEAM SELECTION -->
  <label for="team">Select Team:</label>
  <select id="team" disabled>
    <option value="">-- Select a group first --</option>
  </select>

  <label for="q1">What went well?</label>
  <textarea id="q1" rows="3"></textarea>

  <label for="q2">What could be improved?</label>
  <textarea id="q2" rows="3"></textarea>

  <label for="q3">Any additional comments?</label>
  <textarea id="q3" rows="3"></textarea>

  <button onclick="submitFeedback()">Submit Feedback</button>
  <div id="status"></div>

  <script>
    const CSV_PATH = "teams.csv";  // CSV with S. No., Team Name, Student A/B/C, Groups
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbwLUgC8XroiMGe3cpzr8JSaA9xtBjNRmkmJnZdtx7fhqrGXGaQ8TbIZQjWO-cakDTyH/exec";  // paste your /exec URL here

    let allTeams = [];

    function stripEmail(name) {
      return name.replace(/\s*\([^)]*\)/g, "").trim();
    }

    // Load all teams from CSV
    fetch(CSV_PATH)
      .then(r => r.text())
      .then(t => {
        const lines = t.split("\n").slice(1);
        const groups = new Set();
        allTeams = [];

        lines.forEach(line => {
          if (!line.trim()) return;
          const cols = line.split(",");
          const teamName = cols[1]?.trim();
          const students = [cols[2], cols[3], cols[4]]
            .map(x => (x ? stripEmail(x) : ""))
            .filter(x => x && x.toLowerCase() !== "n/a")
            .join(", ");
          const group = cols[8]?.trim();
          if (teamName && group) {
            groups.add(group);
            allTeams.push({ team: teamName, group, students });
          }
        });

        // Populate group dropdown
        const groupSelect = document.getElementById("group");
        Array.from(groups).sort().forEach(g => {
          const opt = document.createElement("option");
          opt.value = g;
          opt.text = g;
          groupSelect.appendChild(opt);
        });

        // When group changes → filter teams
        groupSelect.addEventListener("change", e => {
          const selectedGroup = e.target.value;
          const teamSelect = document.getElementById("team");
          teamSelect.innerHTML = "";
          if (!selectedGroup) {
            teamSelect.disabled = true;
            teamSelect.innerHTML = '<option value="">-- Select a group first --</option>';
            return;
          }
          const filtered = allTeams.filter(t => t.group === selectedGroup);
          filtered.forEach(t => {
            const opt = document.createElement("option");
            opt.value = JSON.stringify({ team: t.team, group: t.group });
            opt.text = `${t.team} – (${t.students})`;
            teamSelect.appendChild(opt);
          });
          teamSelect.disabled = false;
        });
      });

    // Submit feedback
    function submitFeedback() {
      const teamSelect = document.getElementById("team");
      const selected = teamSelect.value ? JSON.parse(teamSelect.value) : null;
      if (!selected) {
        document.getElementById("status").innerText = "⚠️ Please select a team.";
        return;
      }
      const data = {
        team: selected.team,
        group: selected.group,
        q1: document.getElementById("q1").value,
        q2: document.getElementById("q2").value,
        q3: document.getElementById("q3").value
      };
      fetch(SHEET_URL, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.json())
      .then(() => {
        document.getElementById("status").innerText = "✅ Feedback submitted anonymously!";
        document.getElementById("q1").value = "";
        document.getElementById("
